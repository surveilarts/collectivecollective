<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Magical Orbs Follower</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
    <script>
      // This component makes an entity orbit around the camera rig.
      AFRAME.registerComponent('orb-orbit', {
        schema: {
          radius: { type: 'number', default: 1.5 },       // Distance from the viewer.
          speed: { type: 'number', default: 0.5 },          // Angular speed in radians per second.
          phase: { type: 'number', default: 0 },            // Initial phase offset.
          verticalOffset: { type: 'number', default: 0.5 }    // Vertical offset above the camera rig.
        },
        tick: function (time, delta) {
          // Get the camera rig's position (must have id="cameraRig")
          var cameraRig = document.getElementById('cameraRig');
          if (!cameraRig) { return; }
          var camPos = cameraRig.object3D.position;
          var t = time / 1000;  // time in seconds
          // Calculate the new angle for the orbit using time, speed, and phase offset.
          var angle = this.data.phase + this.data.speed * t;
          // Compute new x and z positions relative to the camera.
          var x = camPos.x + this.data.radius * Math.cos(angle);
          var z = camPos.z + this.data.radius * Math.sin(angle);
          // y position is based on the camera rig with an additional vertical offset.
          var y = camPos.y + this.data.verticalOffset;
          this.el.object3D.position.set(x, y, z);
        }
      });

      // Optional: A component that causes the orbs to pulsate (change in scale) over time
      AFRAME.registerComponent('pulsate', {
        schema: {
          minScale: { type: 'number', default: 0.8 },
          maxScale: { type: 'number', default: 1.2 },
          speed: { type: 'number', default: 2 }  // Pulsations per second
        },
        tick: function (time, delta) {
          var t = time / 1000;
          var scaleFactor = this.data.minScale +
            (this.data.maxScale - this.data.minScale) *
            (0.5 + 0.5 * Math.sin(t * this.data.speed * Math.PI * 2));
          this.el.object3D.scale.set(scaleFactor, scaleFactor, scaleFactor);
        }
      });

      // Component that creates multiple magical orbs dynamically.
      AFRAME.registerComponent('create-orbs', {
        init: function () {
          // Number of orbs to create.
          var orbCount = 10;
          var sceneEl = this.el;
          for (var i = 0; i < orbCount; i++) {
            var orb = document.createElement('a-sphere');
            orb.setAttribute('radius', '0.15'); // Small size for each orb.
            // Give each orb a magical, emissive look.
            orb.setAttribute('material', 'color: #AAF0D1; emissive: #66D1FF; shader: flat;');
            // Randomize parameters for variety:
            var radius = 1.5 + Math.random() * 0.5;         // Orbit radius between 1.5 and 2.0.
            var speed = 0.3 + Math.random() * 0.5;            // Speed between 0.3 and 0.8.
            var phase = Math.random() * Math.PI * 2;          // Phase offset between 0 and 2Ï€.
            var verticalOffset = 0.5 + Math.random() * 0.5;     // Vertical offset from camera rig (0.5-1.0).
            orb.setAttribute('orb-orbit', 'radius: ' + radius +
                                        '; speed: ' + speed +
                                        '; phase: ' + phase +
                                        '; verticalOffset: ' + verticalOffset);
            // Add pulsate effect for extra magic.
            orb.setAttribute('pulsate', '');
            // Append this orb to the scene.
            sceneEl.appendChild(orb);
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene create-orbs>
      <!-- Ambient lighting -->
      <a-entity light="type: ambient; intensity: 0.8" color="#FFFFFF"></a-entity>
      <!-- Directional light for subtle shadows -->
      <a-entity light="type: directional; intensity: 0.6" position="0 1 1"></a-entity>
      <!-- Ground plane -->
      <a-plane color="#222222" rotation="-90 0 0" width="50" height="50"></a-plane>
      
      <!-- Camera Rig: The target for our magical orbs. -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity camera look-controls wasd-controls></a-entity>
        <a-entity hand-controls="hand: left"></a-entity>
        <a-entity hand-controls="hand: right"></a-entity>
      </a-entity>
      
      <!-- A sky for ambiance -->
      <a-sky color="#333333"></a-sky>
    </a-scene>
  </body>
</html>
